<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>提交任务 - 我的订单</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">index
    <script>
        // 设置根字体大小，用于rem适配
        (function() {
            var resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize';
            function recalc() {
                var clientWidth = document.documentElement.clientWidth;
                if (!clientWidth) return;
                document.documentElement.style.fontSize = 18 * (clientWidth / 375) + 'px';
            }
            if (!document.addEventListener) return;
            window.addEventListener(resizeEvt, recalc, false);
            document.addEventListener('DOMContentLoaded', recalc, false);
        })();
    </script>
    <style>
        :root {
            --primary-color: #ff7e00;
            --primary-dark: #ff5f00;
            --bg-light: #f8f9fa;
            --success-color: #4caf50;
            --warning-color: #ff9800;
            --error-color: #f44336;
            --text-primary: #333;
            --text-secondary: #666;
            --text-muted: #999;
            --border-color: #e0e0e0;
            --card-radius: 0.6rem;
            --btn-radius: 0.6rem;
            --spacing: 0.8rem;
            --card-shadow: 0 0.1rem 0.4rem rgba(0, 0, 0, 0.04);
            --btn-shadow: 0 0.15rem 0.6rem rgba(255, 126, 0, 0.25);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        html, body {
            height: 100%;
            font-size: initial;
        }
        
        body {
            background-color: var(--bg-light);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            font-size: 0.75rem;
            line-height: 1.4;
            padding-bottom: 3rem;
        }
        
        /* 顶部区域 */
        .header {
            padding: 0.6rem var(--spacing) 0.8rem;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border-bottom-left-radius: var(--card-radius);
            border-bottom-right-radius: var(--card-radius);
            box-shadow: var(--btn-shadow);
            flex-shrink: 0;
        }
        
        .top-section {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.6rem;
        }
        
        .back-button {
            color: white;
            font-size: 1rem;
            width: 1.8rem;
            height: 1.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .page-title {
            font-size: 0.9rem;
            font-weight: 600;
            text-shadow: 0 0.08rem 0.15rem rgba(0, 0, 0, 0.1);
        }
        
        .user-icon {
            color: white;
            font-size: 1rem;
            width: 1.8rem;
            height: 1.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            visibility: hidden;
        }
        
        /* 内容区域 */
        .content {
            flex: 1;
            overflow-y: auto;
            padding: var(--spacing);
            -webkit-overflow-scrolling: touch;
        }
        
        /* 任务信息卡片 */
        .task-card {
            background: white;
            border-radius: var(--card-radius);
            padding: var(--spacing);
            margin-bottom: var(--spacing);
            box-shadow: var(--card-shadow);
        }
        
        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.5rem;
        }
        
        .task-title {
            font-size: 0.85rem;
            font-weight: 600;
            flex: 1;
            margin-right: 0.5rem;
        }
        
        .task-reward {
            color: var(--primary-color);
            font-weight: bold;
            font-size: 0.9rem;
            text-align: right;
        }
        
        .reward-label {
            font-size: 0.6rem;
            font-weight: bold;
            margin-bottom: 0.1rem;
        }
        
        .task-meta {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 0.5rem;
        }
        
        .meta-item {
            display: flex;
            align-items: center;
            margin-right: 0.8rem;
            margin-bottom: 0.3rem;
            font-size: 0.65rem;
            color: var(--text-secondary);
        }
        
        .meta-item i {
            margin-right: 0.3rem;
            font-size: 0.6rem;
            width: 0.7rem;
            color: var(--text-muted);
        }
        
        .task-section {
            margin-bottom: var(--spacing);
        }
        
        .section-title {
            font-size: 0.7rem;
            font-weight: 600;
            margin-bottom: 0.4rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
        }
        
        .section-title i {
            margin-right: 0.3rem;
            font-size: 0.65rem;
        }
        
        .section-content {
            font-size: 0.7rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }
        
        .task-requirements, .task-review-criteria {
            background-color: #f9f9f9;
            padding: 0.6rem;
            border-radius: 0.4rem;
            margin-top: 0.4rem;
        }
        
        .requirement-item, .criteria-item {
            display: flex;
            margin-bottom: 0.3rem;
            font-size: 0.65rem;
        }
        
        .requirement-item:last-child, .criteria-item:last-child {
            margin-bottom: 0;
        }
        
        .requirement-item i, .criteria-item i {
            margin-right: 0.3rem;
            color: var(--primary-color);
            font-size: 0.55rem;
            margin-top: 0.15rem;
            flex-shrink: 0;
        }
        
        /* 表单区域 */
        .form-card {
            background: white;
            border-radius: var(--card-radius);
            padding: var(--spacing);
            margin-bottom: var(--spacing);
            box-shadow: var(--card-shadow);
        }
        
        .form-group {
            margin-bottom: var(--spacing);
        }
        
        .form-label {
            display: block;
            font-size: 0.7rem;
            font-weight: 600;
            margin-bottom: 0.4rem;
            color: var(--text-secondary);
        }
        
        .form-textarea {
            width: 100%;
            min-height: 5rem;
            padding: 0.6rem;
            border: 1px solid var(--border-color);
            border-radius: 0.4rem;
            font-size: 0.7rem;
            resize: vertical;
            transition: all 0.3s ease;
        }
        
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(255, 126, 0, 0.1);
        }
        
        .file-upload {
            border: 1px dashed var(--border-color);
            border-radius: 0.4rem;
            padding: 1rem;
            text-align: center;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .file-upload:hover {
            border-color: var(--primary-color);
            background-color: #fffaf5;
        }
        
        .file-upload i {
            font-size: 1.5rem;
            color: var(--primary-color);
            margin-bottom: 0.4rem;
        }
        
        .file-upload-text {
            font-size: 0.7rem;
            color: var(--text-secondary);
        }
        
        .file-upload-input {
            display: none;
        }
        
        .uploaded-files {
            margin-top: 0.5rem;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.4rem;
        }
        
        .file-item {
            position: relative;
            border-radius: 0.3rem;
            overflow: hidden;
            height: 4rem;
            background-color: #f0f8ff;
            border: 1px solid #d1e9ff;
        }
        
        .file-thumbnail {
            width: 100%;
            height: 100%;
            object-fit: cover;
            cursor: pointer;
        }
        
        .file-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            font-size: 0.5rem;
        }
        
        .file-placeholder i {
            font-size: 1rem;
            margin-bottom: 0.2rem;
        }
        
        .file-name {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            padding: 0.2rem;
            font-size: 0.5rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .file-remove {
            position: absolute;
            top: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.8);
            width: 1rem;
            height: 1rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--error-color);
            cursor: pointer;
            font-size: 0.6rem;
        }
        
        /* 图片预览模态框 */
        .image-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            max-width: 100%;
            max-height: 100%;
            transition: transform 0.3s ease;
        }
        
        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            background: rgba(0, 0, 0, 0.5);
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10001;
        }
        
        .modal-zoom-controls {
            position: absolute;
            bottom: 1rem;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 0.5rem;
            z-index: 10001;
        }
        
        .zoom-btn {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1rem;
        }
        
        /* 操作按钮 */
        .action-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
            gap: 0.5rem;
        }
        
        .btn {
            flex: 1;
            padding: 0.6rem;
            border-radius: var(--btn-radius);
            font-size: 0.7rem;
            font-weight: 500;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            box-shadow: var(--btn-shadow);
        }
        
        .btn-secondary {
            background: #f0f0f0;
            color: var(--text-secondary);
            box-shadow: 0 0.1rem 0.3rem rgba(0, 0, 0, 0.1);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .btn:active:not(:disabled) {
            transform: translateY(0.1rem);
            box-shadow: 0 0.05rem 0.2rem rgba(0, 0, 0, 0.2);
        }
        
        /* 底部导航 */
        .bottom-nav {
            background: white;
            display: flex;
            justify-content: space-around;
            padding: 0.5rem 0;
            box-shadow: 0 -0.08rem 0.6rem rgba(0, 0, 0, 0.03);
            z-index: 1000;
            border-top-left-radius: 0.75rem;
            border-top-right-radius: 0.75rem;
            flex-shrink: 0;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            width: 100%;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-muted);
            font-size: 0.55rem;
            transition: all 0.2s ease;
            padding: 0.2rem 0.6rem;
            border-radius: 0.5rem;
            border: 0.08rem solid transparent;
            text-decoration: none;
        }
        
        .nav-item.active {
            color: var(--primary-color);
            border-color: #ffecd1;
            transform: translateY(-0.1rem);
        }
        
        .nav-item i {
            font-size: 0.9rem;
            margin-bottom: 0.15rem;
        }

        /* 演示模式提示 */
        .demo-notice {
            background: #e1f5fe;
            border: 1px solid #4fc3f7;
            border-radius: 0.4rem;
            padding: 0.5rem;
            margin-bottom: var(--spacing);
            text-align: center;
            font-size: 0.65rem;
            color: #0277bd;
        }
        
        /* 验证提示 */
        .validation-error {
            color: var(--error-color);
            font-size: 0.65rem;
            margin-top: 0.3rem;
            display: flex;
            align-items: center;
        }
        
        .validation-error i {
            margin-right: 0.3rem;
            font-size: 0.6rem;
        }
        
        /* 加载状态 */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            display: none;
        }
        
        .spinner {
            width: 2.5rem;
            height: 2.5rem;
            border: 3px solid rgba(255, 126, 0, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* 文件上传进度 */
        .file-progress {
            height: 0.2rem;
            background: #e0e0e0;
            border-radius: 0.1rem;
            margin-top: 0.3rem;
            overflow: hidden;
            display: none;
        }
        
        .file-progress-bar {
            height: 100%;
            background: var(--primary-color);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        /* 响应式调整 */
        @media (max-width: 320px) {
            .uploaded-files {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (min-width: 768px) {
            .uploaded-files {
                grid-template-columns: repeat(4, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- 顶部区域 -->
    <div class="header">
        <div class="top-section">
            <div class="back-button" onclick="history.back()">
                <i class="fas fa-arrow-left"></i>
            </div>
            <div class="page-title">提交任务</div>
            <div class="user-icon">
                <i class="fas fa-user"></i>
            </div>
        </div>
    </div>
    
    <!-- 内容区域 -->
    <div class="content" id="content">
        <!-- 内容将通过JavaScript动态生成 -->
    </div>
    
    <!-- 加载状态 -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
    </div>
    
    <!-- 图片预览模态框 -->
    <div class="image-modal" id="imageModal">
        <div class="modal-close" onclick="closeModal()">
            <i class="fas fa-times"></i>
        </div>
        <img class="modal-content" id="modalImage">
        <div class="modal-zoom-controls">
            <div class="zoom-btn" onclick="zoomImage(0.8)">
                <i class="fas fa-search-minus"></i>
            </div>
            <div class="zoom-btn" onclick="resetZoom()">
                <i class="fas fa-sync-alt"></i>
            </div>
            <div class="zoom-btn" onclick="zoomImage(1.2)">
                <i class="fas fa-search-plus"></i>
            </div>
        </div>
    </div>
    
    <!-- 底部导航 -->
      <div class="bottom-nav">
        <a href="index.html" class="nav-item">
            <i class="fas fa-home"></i>
            <span>首页</span>
        </a>
        <a href="doer-client-tasks-list.html" class="nav-item active">
            <i class="fas fa-th-large"></i>
            <span>任务</span>
        </a>
        <a href="doer-client-messages-list.html" class="nav-item">
            <i class="fas fa-comment-dots"></i>
            <span>消息</span>
        </a>
        <a href="doer-client-profile-index.html" class="nav-item">
            <i class="fas fa-user"></i>
            <span>我的</span>
        </a>
    </div>


    <script>
        // 从URL获取订单ID
        const urlParams = new URLSearchParams(window.location.search);
        let orderId = urlParams.get('id');
        
        // 如果没有URL参数，使用默认订单ID
        if (!orderId) {
            orderId = 'TSK-20250820-001';
        }
        
        // 存储上传的文件
        let uploadedFiles = [];
        let isSubmitting = false;
        let currentScale = 1;
        
        // 允许的文件类型和大小限制
        const ALLOWED_FILE_TYPES = ['image/jpeg', 'image/png', 'image/gif', 'application/pdf', 
                                   'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                                   'application/vnd.ms-excel', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
                                   'application/zip', 'application/x-rar-compressed'];
        const MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB
        
        // 订单数据 - 与tasks.html保持一致
        const orders = {
            'in-progress': [
                { 
                    id: 'TSK-20250820-001',
                    category: '线上任务', 
                    icon: 'fa-laptop',
                    name: '网站用户体验测试', 
                    reward: 15, 
                    claimTime: '2025-08-20 10:30', 
                    deadline: '2025-08-25 18:00',
                    status: '进行中',
                    description: '对指定网站进行全面的用户体验测试，包括页面加载速度、导航易用性、功能完整性等方面的评估。',
                    requirements: [
                        '完成所有核心功能的测试',
                        '提供至少5个改进建议',
                        '提交测试报告文档',
                        '提供至少3张测试过程截图'
                    ],
                    reviewCriteria: [
                        '功能测试覆盖率需达到100%',
                        '改进建议需具有实际可行性',
                        '测试报告需详细记录测试过程和结果',
                        '截图需清晰展示测试场景'
                    ]
                },
                { 
                    id: 'TSK-20250821-002',
                    category: '数据录入', 
                    icon: 'fa-keyboard',
                    name: '商品信息录入', 
                    reward: 8, 
                    claimTime: '2025-08-21 14:20', 
                    deadline: '2025-08-24 12:00',
                    status: '进行中',
                    description: '将提供的商品信息准确录入到系统中，确保所有字段填写正确无误。',
                    requirements: [
                        '准确录入100条商品信息',
                        '确保商品分类正确',
                        '所有图片链接有效',
                        '价格和库存信息准确'
                    ],
                    reviewCriteria: [
                        '录入准确率需达到99.5%以上',
                        '分类错误率不得超过1%',
                        '所有必填字段必须完整',
                        '图片链接必须全部有效'
                    ]
                },
                { 
                    id: 'TSK-20250819-003',
                    category: '平面设计', 
                    icon: 'fa-palette',
                    name: '社交媒体海报设计', 
                    reward: 50, 
                    claimTime: '2025-08-19 09:15', 
                    deadline: '2025-08-23 23:59',
                    status: '进行中',
                    description: '为新产品设计一组社交媒体宣传海报，需要符合品牌调性并具有吸引力。',
                    requirements: [
                        '设计3款不同风格的海报',
                        '尺寸符合社交媒体要求',
                        '包含品牌LOGO和核心信息',
                        '提供源文件和JPG格式'
                    ],
                    reviewCriteria: [
                        '设计需符合品牌视觉识别规范',
                        '海报需具有吸引力和传播性',
                        '文字信息清晰易读',
                        '图片分辨率需满足印刷要求'
                    ]
                }
            ]
        };

        // 查找订单
        function findOrder() {
            for (const category in orders) {
                const order = orders[category].find(item => item.id === orderId);
                if (order) return order;
            }
            return null;
        }

        // 格式化日期时间显示
        function formatDateTime(dateTimeStr) {
            const date = new Date(dateTimeStr);
            return `${date.getFullYear()}-${padZero(date.getMonth() + 1)}-${padZero(date.getDate())} ${padZero(date.getHours())}:${padZero(date.getMinutes())}`;
        }

        // 数字补零
        function padZero(num) {
            return num.toString().padStart(2, '0');
        }

        // 计算剩余时间
        function calculateTimeLeft(deadline) {
            const now = new Date();
            const end = new Date(deadline);
            const timeLeft = end - now;
            
            if (timeLeft <= 0) {
                return '任务已结束';
            }
            
            const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
            const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
            
            return `${days}天${hours}小时${minutes}分钟`;
        }

        // 验证文件类型和大小
        function validateFile(file) {
            // 检查文件类型
            if (!ALLOWED_FILE_TYPES.includes(file.type)) {
                return `不支持的文件类型: ${file.type}`;
            }
            
            // 检查文件大小
            if (file.size > MAX_FILE_SIZE) {
                return `文件大小超过限制: ${(file.size / (1024 * 1024)).toFixed(2)}MB > ${MAX_FILE_SIZE / (1024 * 1024)}MB`;
            }
            
            return null;
        }

        // 显示错误提示
        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'validation-error';
            errorDiv.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${message}`;
            
            // 添加到文件上传区域
            const fileUpload = document.querySelector('.file-upload');
            if (fileUpload && fileUpload.parentNode) {
                fileUpload.parentNode.appendChild(errorDiv);
                
                // 3秒后自动移除
                setTimeout(() => {
                    if (errorDiv.parentNode) {
                        errorDiv.parentNode.removeChild(errorDiv);
                    }
                }, 3000);
            }
            
            return errorDiv;
        }

        // 处理文件选择
        function handleFileSelect(event) {
            const files = event.target.files;
            if (!files.length) return;
            
            // 显示进度条
            const progressBar = document.getElementById('fileProgressBar');
            const progressContainer = document.getElementById('fileProgress');
            if (progressBar && progressContainer) {
                progressContainer.style.display = 'block';
                progressBar.style.width = '0%';
            }
            
            let processedFiles = 0;
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                
                // 验证文件
                const error = validateFile(file);
                if (error) {
                    showError(error);
                    continue;
                }
                
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    uploadedFiles.push({
                        name: file.name,
                        size: file.size,
                        type: file.type,
                        data: e.target.result
                    });
                    
                    processedFiles++;
                    
                    // 更新进度
                    if (progressBar) {
                        progressBar.style.width = `${(processedFiles / files.length) * 100}%`;
                    }
                    
                    // 所有文件处理完成
                    if (processedFiles === files.length) {
                        renderUploadedFiles();
                        
                        // 隐藏进度条
                        if (progressContainer) {
                            setTimeout(() => {
                                progressContainer.style.display = 'none';
                            }, 500);
                        }
                    }
                };
                
                reader.readAsDataURL(file);
            }
            
            event.target.value = ''; // 重置input，允许选择相同文件
        }

        // 移除文件
        function removeFile(index) {
            uploadedFiles.splice(index, 1);
            renderUploadedFiles();
        }

        // 获取文件图标
        function getFileIcon(type) {
            if (type.includes('image')) return 'fa-image';
            if (type.includes('pdf')) return 'fa-file-pdf';
            if (type.includes('word')) return 'fa-file-word';
            if (type.includes('excel') || type.includes('sheet')) return 'fa-file-excel';
            if (type.includes('zip') || type.includes('rar')) return 'fa-file-archive';
            return 'fa-file';
        }

        // 渲染已上传的文件列表
        function renderUploadedFiles() {
            const filesContainer = document.getElementById('uploadedFiles');
            if (!filesContainer) return;
            
            if (uploadedFiles.length === 0) {
                filesContainer.innerHTML = '<div style="text-align: center; color: #999; font-size: 0.65rem; padding: 0.5rem; grid-column: 1 / -1;">暂无文件</div>';
                return;
            }
            
            filesContainer.innerHTML = uploadedFiles.map((file, index) => {
                if (file.type.includes('image')) {
                    return `
                        <div class="file-item">
                            <img src="${file.data}" class="file-thumbnail" onclick="openModal('${file.data}')">
                            <div class="file-name">${file.name}</div>
                            <div class="file-remove" onclick="removeFile(${index})">
                                <i class="fas fa-times"></i>
                            </div>
                        </div>
                    `;
                } else {
                    return `
                        <div class="file-item">
                            <div class="file-placeholder">
                                <i class="fas ${getFileIcon(file.type)}"></i>
                                <span>${file.name.split('.').pop()}</span>
                            </div>
                            <div class="file-name">${file.name}</div>
                            <div class="file-remove" onclick="removeFile(${index})">
                                <i class="fas fa-times"></i>
                            </div>
                        </div>
                    `;
                }
            }).join('');
        }

        // 打开图片预览模态框
        function openModal(src) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            modal.style.display = 'flex';
            modalImg.src = src;
            currentScale = 1;
            modalImg.style.transform = `scale(${currentScale})`;
            document.body.style.overflow = 'hidden';
        }

        // 缩放图片
        function zoomImage(factor) {
            currentScale *= factor;
            const modalImg = document.getElementById('modalImage');
            if (modalImg) {
                modalImg.style.transform = `scale(${currentScale})`;
            }
        }

        // 重置缩放
        function resetZoom() {
            currentScale = 1;
            const modalImg = document.getElementById('modalImage');
            if (modalImg) {
                modalImg.style.transform = `scale(${currentScale})`;
            }
        }

        // 关闭模态框
        function closeModal() {
            const modal = document.getElementById('imageModal');
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // 点击模态框背景关闭
        document.getElementById('imageModal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });

        // 验证表单
        function validateForm() {
            const description = document.getElementById('taskDescription').value.trim();
            
            if (!description) {
                showError('请填写任务完成描述');
                return false;
            }
            
            if (description.length < 10) {
                showError('任务描述至少需要10个字符');
                return false;
            }
            
            if (uploadedFiles.length === 0) {
                showError('请至少上传一个文件');
                return false;
            }
            
            return true;
        }

        // 显示加载状态
        function showLoading() {
            const loadingOverlay = document.getElementById('loadingOverlay');
            if (loadingOverlay) {
                loadingOverlay.style.display = 'flex';
            }
        }

        // 隐藏加载状态
        function hideLoading() {
            const loadingOverlay = document.getElementById('loadingOverlay');
            if (loadingOverlay) {
                loadingOverlay.style.display = 'none';
            }
        }

        // 提交表单
        function submitForm() {
            if (isSubmitting) return;
            
            if (!validateForm()) return;
            
            isSubmitting = true;
            
            // 在实际应用中，这里应该发送数据到服务器
            // 模拟提交过程
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 提交中...';
            
            showLoading();
            
            setTimeout(() => {
                hideLoading();
                alert('任务提交成功！等待审核中...');
                isSubmitting = false;
                
                // 跳转回任务列表页
                window.location.href = 'tasks.html';
            }, 2000);
        }

        // 渲染任务提交表单
        function renderTaskSubmit() {
            const order = findOrder();
            const contentEl = document.getElementById('content');
            
            // 添加演示模式提示
            contentEl.innerHTML = `
                <div class="demo-notice">
                    <i class="fas fa-info-circle"></i> 演示模式：已加载模拟数据
                </div>
                
                <div class="file-progress" id="fileProgress">
                    <div class="file-progress-bar" id="fileProgressBar"></div>
                </div>
            `;
            
            if (!order) {
                contentEl.innerHTML += `
                    <div style="text-align: center; padding: 2rem; color: #888;">
                        <i class="fas fa-exclamation-circle" style="font-size: 2rem; margin-bottom: 1rem;"></i>
                        <div>未找到该任务</div>
                    </div>
                `;
                return;
            }
            
            const timeLeft = calculateTimeLeft(order.deadline);
            
            contentEl.innerHTML += `
                <div class="task-card">
                    <div class="task-header">
                        <div class="task-title">${order.name}</div>
                        <div class="task-reward">
                            <div class="reward-label">赏金</div>
                            <div>¥${order.reward}</div>
                        </div>
                    </div>
                    
                    <div class="task-meta">
                        <div class="meta-item">
                            <i class="fas fa-tag"></i>
                            <span>${order.category}</span>
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-barcode"></i>
                            <span>ID: ${order.id}</span>
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-clock"></i>
                            <span>剩余: ${timeLeft}</span>
                        </div>
                    </div>
                    
                    <div class="task-section">
                        <div class="section-title">
                            <i class="fas fa-tasks"></i>
                            <span>任务要求</span>
                        </div>
                        <div class="task-requirements">
                            ${order.requirements.map(req => `
                                <div class="requirement-item">
                                    <i class="fas fa-check-circle"></i>
                                    <span>${req}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="task-section">
                        <div class="section-title">
                            <i class="fas fa-clipboard-check"></i>
                            <span>审核标准</span>
                        </div>
                        <div class="task-review-criteria">
                            ${order.reviewCriteria.map(criteria => `
                                <div class="criteria-item">
                                    <i class="fas fa-star"></i>
                                    <span>${criteria}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
                
                <div class="form-card">
                    <div class="form-group">
                        <label class="form-label">任务完成描述</label>
                        <textarea class="form-textarea" id="taskDescription" placeholder="请详细描述您完成任务的过程和结果..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">上传文件</label>
                        <div class="file-upload" onclick="document.getElementById('fileInput').click()">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <div class="file-upload-text">点击或拖拽文件到此处上传</div>
                            <div class="file-upload-text" style="font-size: 0.6rem; margin-top: 0.3rem;">
                                支持格式: JPG, PNG, PDF, DOC, XLS, ZIP | 最大10MB
                            </div>
                        </div>
                        <input type="file" id="fileInput" class="file-upload-input" multiple onchange="handleFileSelect(event)">
                        
                        <div class="uploaded-files" id="uploadedFiles">
                            <div style="text-align: center; color: #999; font-size: 0.65rem; padding: 0.5rem; grid-column: 1 / -1;">暂无文件</div>
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="btn btn-secondary" onclick="history.back()">取消</button>
                        <button class="btn btn-primary" id="submitBtn" onclick="submitForm()">确认提交</button>
                    </div>
                </div>
            `;
            
            // 初始化已上传文件列表
            renderUploadedFiles();
            
            // 自动填充一些模拟数据
            setTimeout(() => {
                const textarea = document.getElementById('taskDescription');
                if (textarea) {
                    textarea.value = `已完成网站用户体验测试任务。\n\n测试过程：\n1. 测试了所有核心功能，包括用户注册、登录、浏览商品、下单支付等流程\n2. 记录了页面加载时间，主要页面均在3秒内完成加载\n3. 检查了导航结构的合理性，发现两处可以优化的地方\n\n测试结果：\n- 网站整体体验良好，功能完整\n- 发现3个需要改进的问题（详见报告文档）\n- 提供了7条改进建议\n\n已按要求完成所有测试项目并生成详细报告。`;
                }
                
                // 添加模拟上传的文件
                uploadedFiles = [
                    { 
                        name: '网站用户体验测试报告.docx', 
                        size: 24576, 
                        type: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                        data: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiBmaWxsPSIjMWQ5NmYzIj48cGF0aCBkPSJNNDY0IDQ0OEg0OGMtMjYuNTEgMC00OC0yMS40OS00OC00OFYxMTJjMC0yNi41MSAyMS40OS00OCA0OC00OGgyODhjMjYuNTEgMCA0OCAyMS40OSA0OCA0OHYyODhjMCAyNi41MS0yMS40OSA0OC00OCA0OHptLTMyLTMyYzguODIzIDAgMTYtNy4xNzcgMTYtMTZWMTQ0YzAtOC44MjMtNy4xNzctMTYtMTYtMTZIMTQ0Yy04LjgyMyAwLTE2IDcuMTc3LTE2IDEwdjI1NmMwIDguODIzIDcuMTc3IDE2IDE2IDE2aDI4OHoiLz48cGF0aCBkPSJNMzM2LjA2NCAyNTZIMTc1LjkyN2MtOC44MjMgMC0xNi03LjE3Ny0xNi0xNnM3LjE3Ny0xNiAxNi0xNmgxNjAuMTM3YzguODIzIDAgMTYgNy4xNzcgMTYgMTZzLTcuMTc3IDE2LTE2IDE2em0wIDY0SDE3NS45MjdjLTguODIzIDAtMTYtNy4xNzctMTYtMTZzNy4xNzctMTYgMTYtMTZoMTYwLjEzN2M4LjgyMyAwIDE2IDcuMTc3IDE2IDE2cy03LjE3NyAxNi0xNiAxNnptMCA2NEgxNzUuOTI3Yy04LjgyMyAwLTE2LTcuMTc3LTE2LTE2czcuMTc3LTE2IDE2LTE2aDE2MC4xMzdjOC44MjMgMCAxNiA3LjE3NyAxNiAxNnMtNy4xNzcgMTYtMTYgMTZ6Ii8+PC9zdmc+'
                    },
                    { 
                        name: '测试过程截图1.png', 
                        size: 102400, 
                        type: 'image/png',
                        data: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiBmaWxsPSIjNGNhZmUxIj48cGF0aCBkPSJNNDY0IDgwSDQ4Yy0yNi41MSAwLTQ4IDIxLjQ5LTQ4IDQ4djI1NmMwIDI2LjUxIDIxLjQ5IDQ4IDQ4IDQ4aDQxNmMyNi41MSAwIDQ4LTIxLjQ5IDQ4LTQ4VjEyOGMwLTI2LjUxLTIxLjQ5LTQ4LTQ4LTQ4em0tNiAyNTZINDRjLTMuMzE0IDAtNi0yLjY4Ni02LTZWMTM0YzAtMy4zMTQgMi42ODYtNiA2LTZoNDA0YzMuMzE0IDAgNiAyLjY4NiA2IDZ2MjUyYzAgMy4zMTQtMi42ODYgNi02IDZ6Ii8+PHBhdGggZD0iTTM1OC41IDI1NmMwIDU2LjcxOS00NS45ODEgMTAyLjUtMTAyLjUgMTAyLjVTMTUzLjUgMzEyLjcxOSAxNTMuNSAyNTZzNDUuOTgxLTEwMi41IDEwMi41LTEwMi41UzM1OC41IDE5OS4yODEgMzU4LjUgMjU2eiIvPjxjaXJjbGUgY3g9IjM1MiIgY3k9IjE2MCIgcj0iMjAiIGZpbGw9IiNmZmYiLz48L3N2Zz4='
                    },
                    { 
                        name: '测试过程截图2.png', 
                        size: 98600, 
                        type: 'image/png',
                        data: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiBmaWxsPSIjZmY3ZTAwIj48cGF0aCBkPSJNNDY0IDgwaC00OEg5NnY0OEg0OGMtMjYuNTEgMC00OCAyMS40OS00OCA0OHY0OGg0ODB2LTQ4YzAtMjYuNTEtMjEuNDktNDgtNDgtNDh6bTAgMjU2YzI2LjUxIDAgNDgtMjEuNDkgNDgtNDhoLTQ4djQ4ek05NiAzODR2LTQ4SDQ4YzAgMjYuNTEgMjEuNDkgNDggNDggNDh6bTMyMC0xNjBIMTIwYy00LjQxOCAwLTggMy41ODItOCA4djE0NGMwIDQuNDE4IDMuNTgyIDggOCA4aDI5NmM0LjQxOCAwIDgtMy41ODIgOC04VjIzMmMwLTQuNDE4LTMuNTgyLTgtOC04em0wIDEyOEgxMjB2LTY0aDI5NnY2NHoiLz48L3N2Zz4='
                    },
                    { 
                        name: '测试过程截图3.png', 
                        size: 105200, 
                        type: 'image/png',
                        data: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiBmaWxsPSIjZWM0MjJlIj48cGF0aCBkPSJNNDY0IDY0SDQ4QzIxLjQ5IDY0IDAgODUuNDkgMCAxMTJ2Mjg4YzAgMjYuNTEgMjEuNDkgNDggNDggNDhoNDE2YzI2LjUxIDAgNDgtMjEuNDkgNDgtNDhWMTEyYzAtMjYuNTEtMjEuNDktNDgtNDgtNDh6bTAgMzM2SDQ4VjExMmg0MHY0MGgtMzJjLTQuNDE4IDAtOCAzLjU4Mi04IDh2MTZjMCA0LjQxOCAzLjU4MiA4IDggOGgyMjRjNC40MTggMCA4LTMuNTgyIDgtOHYtMTZjMC00LjQxOC0zLjU4Mi04LTgtOGgtMzJ2LTQwaDE2MHYyODB6Ii8+PHBhdGggZD0iTTE4NCAyODBoMTQ0YzQuNDE4IDAgOC0zLjU4MiA4LTh2LTE2YzAtNC40MTgtMy41ODItOC04LThIMTg0Yy00LjQxOCAwLTggMy41ODItOCA4djE2YzAgNC40MTggMy41ODIgOCA4IDh6bTAgNjRoMTQ0YzQuNDE4IDAgOC0zLjU4MiA4LTh2LTE2YzAtNC40MTgtMy41ODItOC04LThIMTg0Yy00LjQxOCAwLTggMy41ODItOCA4djE2YzAgNC40MTggMy41ODIgOCA4IDh6bTAgNjRoMTQ0YzQuNDE4IDAgOC0zLjU4MiA4LTh2LTE2YzAtNC40MTgtMy41ODItOC04LThIMTg0Yy00LjQxOCAwLTggMy41ODItOCA4djE2YzAgNC40MTggMy41ODIgOCA4IDh6TTEyOCAyMjRoNjR2LTY0aC02NHY2NHptMC05Nmg2NHYtNjRoLTY0djY0eiIvPjwvc3ZnPg=='
                    }
                ];
                
                renderUploadedFiles();
            }, 100);
        }

        // 初始化页面
        document.addEventListener('DOMContentLoaded', function() {
            renderTaskSubmit();
        });
    </script>
</body>
</html>